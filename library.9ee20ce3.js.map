{"mappings":"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","sources":["src/library.js","src/js/library-cards.js"],"sourcesContent":["// import cardTemplate from './templates/film-card.hbs';\n// import './js/pagination';\n// import './js/to-top';\n// import './js/preloader';\nimport './js/theme-switch';\nimport './js/library-cards';\nimport './js/modal-open-card';\n","import { loaderRender } from './preloader';\nimport cardTemplate from '../templates/film-card.hbs';\nimport { numberConverter } from './prepare-number';\n\nconst paginationBox = document.querySelector('.pagination__list');\nconst cards = document.querySelector('.cards');\nconst emptyEl = document.querySelector('.empty');\nconst modalOpenEl = document.querySelector('.cards');\nconst modalCloseEl = document.querySelector('[data-modal-close]');\nconst modalEl = document.querySelector('[data-modal]');\nconst backdropEl = document.querySelector('.backdrop');\nconst watchedFilmListBtnEl = document.getElementById('js-WatchedButton');\nconst queuedFilmListBtnEl = document.getElementById('js-QueueButton');\nconst WATCHED_STORAGE_KEY = \"watched films\";\nconst QUEUE_STORAGE_KEY = \"films in queue\";\nlet globalCurrentPage = 1;\nlet renderFilmCardPage = null;\n\nloaderRender();\n\nwatchedFilmListBtnEl.addEventListener('click', onLSLoadWatched);\nqueuedFilmListBtnEl.addEventListener('click', onLSLoadQueue);\n\n// слухач на батьківський UL карток\nmodalOpenEl.addEventListener('click', onModalOpenClick);\n\n// ==============================================\n// Початкова ініціалізація сторінки\nonLSLoadWatched(\"watched films\");\n// ==============================================\n\n\n// ================================================\n// Функція зчитування даних з ЛС\n// повертає масив об'єктів або null\nfunction readFromLS(key) {\n    let filmsArray = JSON.parse(localStorage.getItem(key));\n    // перевірка на наявність масиву в ЛС\n    if (filmsArray === null) {\n        return;\n    }\n    return filmsArray;\n};\n// ================================================\n\n\n// ===========================================================\n// Функції-обробники перемикача в хедері\n// Функція-обробник кліку перемикача QUEUE\nfunction onLSLoadWatched() {\n    // перевірка на наявність масиву в ЛС\n    let filmsArray = JSON.parse(localStorage.getItem(WATCHED_STORAGE_KEY));\n    if (filmsArray === null) {\n        return;\n    }\n\n\n\n    contentRender(WATCHED_STORAGE_KEY, 'watched', 1);\n}\n\n// Функція-обробник кліку перемикача WATCHED\nfunction onLSLoadQueue() {\n    // перевірка на наявність масиву в ЛС\n    let filmsArray = JSON.parse(localStorage.getItem(QUEUE_STORAGE_KEY));\n    if (filmsArray === null) {\n        return;\n    }\n    contentRender(QUEUE_STORAGE_KEY, 'queued', 1);\n}\n// ===========================================================\n\n\n// ===========================================================\n// Універсальна функція вимальовки всього контенту на стоірнці\nfunction contentRender(storageKey, attrib, currPage) {\n    // витягує масив фільмів з ЛС\n    const filmArr = readFromLS(storageKey);\n\n    // перевірка на наявність масиву в ЛС\n    if (filmArr === null) {\n        return;\n    }\n\n    // змінює дата-атрибут\n    cards.dataset.position = attrib;\n    // Додаєм атрибут поточної позиції пагінації\n    cards.dataset.page = currPage;\n\n    // Визначаю кількість сторінок\n    let allPages = splitArrayOnSubarrays(filmArr).length;\n\n    // Обрізка масиву на порції\n    // При цьому треба пам'ятати, що нумерація порції даних\n    // (тобто масива в масиві) починається з 0\n    renderFilmCardPage = currPage - 1;\n    let arrPortion = splitArrayOnSubarrays(filmArr)[renderFilmCardPage];\n\n    // Перевірка підмасиву на те, чи він не пустий\n    if (arrPortion === \"undefined\") {\n        return;\n    }\n\n    // рендерить масив фільмів\n    renderFilmCards(arrPortion, currPage);\n\n    // рендерить пагінацію\n    paginationMarkupRender(currPage, allPages);\n}\n// ===========================================================\n\n\n// ===========================================================\n// Функція, що підготовлює дані в картки для рендеру\n// - Приймає масив об'єктів\n// - Рендерить об'єкти в картки на сторінці\nfunction renderFilmCards(films) {\n    if (films === undefined) {\n        return;\n    }\n\n    const markup = films.map(film => {\n\n        const rating = numberConverter(film.vote_average);\n\n        // Формую підготовлений об'єкт даних для закидання в handlebar\n        const editedFilm = {\n            ...film,\n            poster_path: `https://image.tmdb.org/t/p/w500${film.poster_path}`,\n            genres: film.filmGenres,\n            release_date: film.release_date.slice(0, 4),\n            vote_average: rating,\n        };\n        return editedFilm;\n    });\n\n    emptyEl.innerHTML = '';\n    cards.innerHTML = cardTemplate(markup);\n}\n// ===========================================================\n\n\n\n\n\n// ======================================\n// PAGINATION\n// Обробка результатів пошуку\n// ======================================\n\npaginationBox.addEventListener('click', onPaginationLibraryClick);\n\n// Функція розбивки масиву на підмасиви\n// - повертає масив масивів\nfunction splitArrayOnSubarrays(array) {\n\n    const allCards = 20;\n    const sliceArr = array\n        .map(function (el, ind) {\n            return ind % allCards === 0 ? array.slice(ind, ind + allCards) : null;\n        })\n        .filter(function (el) {\n            return el;\n        });\n    // Повертає масив масивів\n    return sliceArr;\n}\n\n// Функція рендеру кнопок пагінації\nfunction paginationMarkupRender(currentPage, allPages) {\n    let markup = '';\n    let beforeTwoPage = currentPage - 2;\n    let beforePage = currentPage - 1;\n    globalCurrentPage = currentPage;\n    let afterPage = currentPage + 1;\n    let afterTwoPage = currentPage + 2;\n\n    if (currentPage > 1) {\n        markup += `<li class=\"pagination__item slider-arrow prev\">&#129144</li>`;\n        markup += `<li class=\"pagination__item\">1</li>`;\n    }\n    if (currentPage > 4) {\n        markup += `<li class=\"pagination__item dots\">...</li>`;\n    }\n    if (currentPage > 3) {\n        markup += `<li class=\"pagination__item\">${beforeTwoPage}</li>`;\n    }\n    if (currentPage > 2) {\n        markup += `<li class=\"pagination__item\">${beforePage}</li>`;\n    }\n    markup += `<li class=\"pagination__item pagination__item--current\">${currentPage}</li>`;\n\n    if (allPages - 1 > currentPage) {\n        markup += `<li class=\"pagination__item\">${afterPage}</li>`;\n    }\n    if (allPages - 2 > currentPage) {\n        markup += `<li class=\"pagination__item\">${afterTwoPage}</li>`;\n    }\n    if (allPages - 3 > currentPage) {\n        markup += `<li class=\"pagination__item dots\">...</li>`;\n    }\n    if (allPages > currentPage) {\n        markup += `<li class=\"pagination__item\">${allPages}</li>`;\n        markup += `<li class=\"pagination__item slider-arrow next\">&#129146</li>`;\n    }\n    paginationBox.innerHTML = markup;\n}\n\n// Функція обробки кліків пагінації\nfunction onPaginationLibraryClick(event) {\n    if (event.target.nodeName !== 'LI') {\n        return;\n    }\n    if (event.target.textContent === '...') {\n        return;\n    }\n    if (event.target.textContent === '🡸') {\n        if (cards.dataset.position === 'watched') {\n            globalCurrentPage -= 1;\n            contentRender(WATCHED_STORAGE_KEY, 'watched', globalCurrentPage);\n            return;\n        }\n        if (cards.dataset.position === 'queued') {\n            globalCurrentPage -= 1;\n            contentRender(QUEUE_STORAGE_KEY, 'queued', globalCurrentPage);\n            return;\n        }\n    }\n    if (event.target.textContent === '🡺') {\n        if (cards.dataset.position === 'watched') {\n            globalCurrentPage += 1;\n            contentRender(WATCHED_STORAGE_KEY, 'watched', globalCurrentPage);\n            return;\n        }\n        if (cards.dataset.position === 'queued') {\n            globalCurrentPage += 1;\n            contentRender(QUEUE_STORAGE_KEY, 'queued', globalCurrentPage);\n            return;\n        }\n    }\n\n    const page = Number(event.target.textContent);\n    globalCurrentPage = page;\n    if (cards.dataset.position === 'watched') {\n        contentRender(WATCHED_STORAGE_KEY, 'watched', globalCurrentPage);\n        return;\n    }\n    if (cards.dataset.position === 'queued') {\n        contentRender(QUEUE_STORAGE_KEY, 'queued', globalCurrentPage);\n        return;\n    }\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// =======================================\n// Функції відкриття / закриття модалки\n// =======================================\nasync function onModalOpenClick(event) {\n    event.preventDefault();\n    if (event.target.closest('li')) {\n        modalEl.classList.remove('is-hidden');\n        modalCloseEl.addEventListener('click', onModalCloseClick);\n        backdropEl.addEventListener('click', onBackdropElClick);\n        window.addEventListener('keydown', onEscBtnClick);\n        console.log(\"I clicked on card\");\n    }\n}\n\nfunction onModalCloseClick() {\n    modalEl.classList.add('is-hidden');\n    modalCloseEl.removeEventListener('click', onModalCloseClick);\n    backdropEl.removeEventListener('click', onBackdropElClick);\n    window.removeEventListener('keydown', onEscBtnClick);\n\n    // Викликаю функцію ререндеру вмісту сторінки бібліотеки\n    // Умови для ререндеру\n    if (cards.dataset.position === \"watched\") {\n\n        let currDataPage = Number(cards.dataset.page);\n        contentRender(WATCHED_STORAGE_KEY, 'watched', currDataPage);\n    }\n    if (cards.dataset.position === \"queued\") {\n\n        const filmArr = readFromLS(QUEUE_STORAGE_KEY);\n        let allPages = splitArrayOnSubarrays(filmArr).length;\n        let arrPortion = splitArrayOnSubarrays(filmArr)[renderFilmCardPage];\n        console.log('allPages :>> ', allPages);\n        console.log('arrPortion :>> ', arrPortion);\n\n        if (cards.dataset.page === allPages && arrPortion.length === 1) {\n            contentRender(QUEUE_STORAGE_KEY, 'queued', 1);\n            return;\n        }\n\n        // Якщо наш атрибут dataset.page === allPages\n        // І якщо arrPortion.length === 1\n\n        let currDataPage = Number(cards.dataset.page);\n        contentRender(QUEUE_STORAGE_KEY, 'queued', currDataPage);\n    }\n\n}\n\nfunction onBackdropElClick(event) {\n    if (event.target === backdropEl) {\n        onModalCloseClick();\n    }\n}\n\nfunction onEscBtnClick(event) {\n    if (event.code === 'Escape') {\n        onModalCloseClick();\n    }\n}\n// ======================================="],"names":["parcelRequire","$ioBS9","$120d9dea778dffdf$var$paginationBox","document","querySelector","$120d9dea778dffdf$var$cards","$120d9dea778dffdf$var$emptyEl","$120d9dea778dffdf$var$modalOpenEl","$120d9dea778dffdf$var$modalCloseEl","$120d9dea778dffdf$var$modalEl","$120d9dea778dffdf$var$backdropEl","$120d9dea778dffdf$var$watchedFilmListBtnEl","getElementById","$120d9dea778dffdf$var$queuedFilmListBtnEl","$120d9dea778dffdf$var$globalCurrentPage","$120d9dea778dffdf$var$renderFilmCardPage","$120d9dea778dffdf$var$readFromLS","key","filmsArray","JSON","parse","localStorage","getItem","$120d9dea778dffdf$var$onLSLoadWatched","$120d9dea778dffdf$var$contentRender","storageKey","attrib","currPage","filmArr","dataset","position","page","allPages","$120d9dea778dffdf$var$splitArrayOnSubarrays","length","arrPortion","films","undefined","markup","map","film","rating","$3ab2c","numberConverter","vote_average","poster_path","genres","filmGenres","release_date","slice","innerHTML","$kW34H","default","$120d9dea778dffdf$var$renderFilmCards","currentPage","beforeTwoPage","beforePage","afterPage","afterTwoPage","$120d9dea778dffdf$var$paginationMarkupRender","array","el","ind","filter","$120d9dea778dffdf$var$onModalCloseClick","classList","add","removeEventListener","$120d9dea778dffdf$var$onBackdropElClick","window","$120d9dea778dffdf$var$onEscBtnClick","Number","console","log","event","target","code","loaderRender","addEventListener","async","preventDefault","closest","remove","nodeName","textContent"],"version":3,"file":"library.9ee20ce3.js.map"}